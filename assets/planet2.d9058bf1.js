import{e as ft}from"./strega_bg.a0dc8f16.js";import{u as ut,V as $,M as $e,C as D,P as mt,G as ke,c as pt,d as gt,F as je,g as ht,D as wt,T,L as vt,f as G,A as yt,i as xt,j as St,S as Ke,v as Ve,k as Lt,r as Et,w as A,O as bt,x as Ye,I as zt,y as Ge,e as z,W as It,s as Mt,m as Pt,E as qe,U as Bt,n as At,o as Ft,z as Tt,p as Ct,q as Dt,t as _t}from"./Lensflare.e251edb4.js";const y=new ut,he=new $;class Rt{constructor(r){let c=r.geometry;if(!c.isBufferGeometry||c.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");c.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),c=c.toNonIndexed()),this.geometry=c,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(r){return this.weightAttribute=r?this.geometry.getAttribute(r):null,this}build(){const r=this.positionAttribute,c=this.weightAttribute,h=new Float32Array(r.count/3);for(let d=0;d<r.count;d+=3){let s=1;c&&(s=c.getX(d)+c.getX(d+1)+c.getX(d+2)),y.a.fromBufferAttribute(r,d),y.b.fromBufferAttribute(r,d+1),y.c.fromBufferAttribute(r,d+2),s*=y.getArea(),h[d/3]=s}this.distribution=new Float32Array(r.count/3);let w=0;for(let d=0;d<h.length;d++)w+=h[d],this.distribution[d]=w;return this}setRandomGenerator(r){return this.randomFunction=r,this}sample(r,c,h){const w=this.distribution[this.distribution.length-1],d=this.binarySearch(this.randomFunction()*w);return this.sampleFace(d,r,c,h)}binarySearch(r){const c=this.distribution;let h=0,w=c.length-1,d=-1;for(;h<=w;){const s=Math.ceil((h+w)/2);if(s===0||c[s-1]<=r&&c[s]>r){d=s;break}else r<c[s]?w=s-1:h=s+1}return d}sampleFace(r,c,h,w){let d=this.randomFunction(),s=this.randomFunction();return d+s>1&&(d=1-d,s=1-s),y.a.fromBufferAttribute(this.positionAttribute,r*3),y.b.fromBufferAttribute(this.positionAttribute,r*3+1),y.c.fromBufferAttribute(this.positionAttribute,r*3+2),c.set(0,0,0).addScaledVector(y.a,d).addScaledVector(y.b,s).addScaledVector(y.c,1-(d+s)),h!==void 0&&y.getNormal(h),w!==void 0&&this.colorAttribute!==void 0&&(y.a.fromBufferAttribute(this.colorAttribute,r*3),y.b.fromBufferAttribute(this.colorAttribute,r*3+1),y.c.fromBufferAttribute(this.colorAttribute,r*3+2),he.set(0,0,0).addScaledVector(y.a,d).addScaledVector(y.b,s).addScaledVector(y.c,1-(d+s)),w.r=he.x,w.g=he.y,w.b=he.z),this}}let J=!1;var p=0;sessionStorage.getItem("save")?(J=sessionStorage.getItem("save"),p=JSON.parse(sessionStorage.getItem("save")).graphics):J=!1;sessionStorage.getItem("graphics")&&(p=sessionStorage.getItem("graphics"));var ze=0,Ie=0;sessionStorage.getItem("difficulty")&&(ze=sessionStorage.getItem("difficulty"));sessionStorage.getItem("punteggio")&&(Ie=sessionStorage.getItem("punteggio"));let n,m,B,S,Ue,U,Ce,De,_e,Z,Oe,Me=100,F=Me,L=13,k=!1,j=!1,Je=performance.now();const I=new $;let K=!0;var V=1,we=0,We=1,He=1,ye=!1,xe=!1,Se=!1,Le=!1,Q,H,N,x,ee=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(ee=!0);const Ut=new $e({color:"black"}),Ee={};var q=new D(10070783);const et=1,tt=new Ct;tt.set(et);n=new mt(60,window.innerWidth/window.innerHeight,1,1e6);var e=[];for(var o=0;o<L;o++)e[o]=new ke,e[o].outer=80,e[o].inner=50,e[o].mixer;var v=new ke,g=[];for(var o=0;o<L;o++)g[o]=document.getElementById("planet"+o),g[o].open=!1;var O=!1,C=!1;const be=document.getElementById("crossair"),X=document.getElementById("crossair-text"),Ot=document.getElementById("commandList");Wt();at();function Wt(){const l=new Dt;l.onLoad=function(){document.getElementById("preloader").style.opacity="0",setTimeout(function(){document.getElementById("preloader").style.display="none"},1e3),J&&Qe(sessionStorage.getItem("save"))},n.position.z=360,n.position.y=30,n.position.x=-60,n.rotation.x=-.4,n.rotation.order="YXZ",m=new pt,Oe=new gt(l).load(["model/skybox/1.png","model/skybox/2.png","model/skybox/3.png","model/skybox/4.png","model/skybox/5.png","model/skybox/6.png"]),m.background=Oe,m.fog=new je(10070783,5e-4),S=new ht(n,document.body);const c=document.getElementById("blocker"),h=document.getElementById("startButton"),w=document.getElementById("menu"),d=document.getElementById("pause");h.addEventListener("click",function(){ee?(c.classList.add("transparent"),w.classList.add("reduce"),d.classList.add("reduce"),be.classList.remove("display"),K=!0,document.getElementById("esc").style.display=""):S.lock();for(var t=0;t<L;t++)g[t].classList.add("reduce"),g[t].open=!1}),S.addEventListener("lock",function(){c.classList.add("transparent"),w.classList.add("reduce"),d.classList.add("reduce"),be.classList.remove("display"),K=!0}),S.addEventListener("unlock",function(){c.classList.remove("transparent"),d.classList.remove("reduce"),O=!1;for(var t=0;t<L;t++)if(g[t].open){O=!0;break}O||w.classList.remove("reduce"),be.classList.add("display"),K=!1}),m.add(S.getObject());const s=function(t){switch(t.code){case"KeyQ":case"KeyP":S.unlock();break;case"ArrowUp":case"KeyW":k=!0;break;case"ArrowDown":case"KeyS":j=!0;break;case"KeyE":F=200*V;break;case"KeyC":Ot.classList.toggle("activemanual");break}},E=function(t){switch(t.code){case"ArrowUp":case"KeyW":k=!1;break;case"ArrowDown":case"KeyS":j=!1;break;case"KeyE":F=Me*V;break}},P=16777215,it=1;if(x=new wt(P,it),x.castShadow=!0,x.position.set(400,2e3,-800),x.target.position.set(0,0,200),!ee&&p!=0){x.shadow.bias=-.002,x.shadow.radius=3,x.shadow.mapSize.width=7e3,x.shadow.mapSize.height=7e3,m.add(x.target);const t=x.shadow.camera;t.near=900,t.far=3500,t.left=-1250,t.right=1250,t.top=1e3,t.bottom=-1e3;const a=new T,i=a.load("model/planet1/lensflare0.png"),W=a.load("model/planet1/lensflare3.png"),u=new vt;u.addElement(new G(W,700,.3)),u.addElement(new G(i,1250,.6,x.color)),u.addElement(new G(i,520,.7)),u.addElement(new G(W,520,.8)),u.addElement(new G(i,400,1,x.color)),x.add(u)}const ot=new yt(5263440);m.add(ot);const nt=new xt(700,40,40),Ne=new D;Ne.setHex(16104516);const rt=new $e({color:Ne}),Y=new St(nt,rt);if(Y.position.y=2e3,Y.position.x=400,Y.position.z=-800,Y.layers.enable(et),v.add(x),v.add(Y),m.add(v),p>=1){var Pe=new T;Pe.crossOrigin="";var st=Pe.load("model/planet2/blade_diffuse.jpg"),dt=Pe.load("model/planet2/blade_alpha.jpg");const t=`
		varying vec2 vUv;
		uniform float time;
		
		${simpleNoise}
		
			void main() {

			vUv = uv;
			float t = time * 2.;
			
			// VERTEX POSITION
			
			vec4 mvPosition = vec4( position, 1.0 );
			#ifdef USE_INSTANCING
				mvPosition = instanceMatrix * mvPosition;
			#endif
			
			// DISPLACEMENT
			
			float noise = smoothNoise(mvPosition.xz * 0.5 + vec2(0., t));
			noise = pow(noise * 0.5 + 0.5, 2.) * 5.;
			
			// here the displacement is made stronger on the blades tips.
			float dispPower = 1. - cos( uv.y * 3.1416 * 0.5 );
			
			float displacement = noise * ( 0.3 * dispPower );
			mvPosition.z -= displacement;
			
			//
			
			vec4 modelViewPosition = modelViewMatrix * mvPosition;
			gl_Position = projectionMatrix * modelViewPosition;

			}
		`,a=`
		varying vec2 vUv;

		uniform vec3 fogColor;
		uniform float fogNear;
		uniform float fogFar;

		uniform float time;
		uniform float light;

		//Surface uniforms
		uniform sampler2D map;
		uniform sampler2D alphaMap;
		
		void main() {
			if(texture2D(alphaMap, vUv).r < 0.15){
				discard;
			}

			vec3 baseColor = vec3( 0.3 , 1, 0.3 );
			float clarity = ( vUv.y * 0.575 ) + 0.425;
			gl_FragColor = vec4( baseColor * clarity, 1 );

			//Get colour data from texture
			vec3 textureColour = pow(texture2D(map, vUv).rgb, vec3(2.2));

			vec3 color1 = mix(gl_FragColor.rgb, textureColour, 0.7);

			#ifdef USE_FOG
				#ifdef USE_LOGDEPTHBUF_EXT
					float depth = gl_FragDepthEXT / gl_FragCoord.w;
				#else
					float depth = gl_FragCoord.z / gl_FragCoord.w;
				#endif
				float fogFactor = smoothstep( fogNear, fogFar, depth );
				color1 = mix( color1, fogColor, fogFactor );
			#endif

			vec3 color2 = fogColor;

			gl_FragColor.rgb = mix(color1, color2, light);			
		}
		`,i={time:{value:0},light:{value:0},fogColor:{type:"c",value:m.fog.color},fogNear:{type:"f",value:m.fog.near},fogFar:{type:"f",value:m.fog.far},map:{value:st},alphaMap:{value:dt}};Q=new Ke({vertexShader:t,fragmentShader:a,uniforms:i,side:Ve,fog:!0})}var f=0;let Be;const b=new Lt(l);var te;p==0&&(te="model/planet2/surface.glb"),p==1&&(te="model/planet2/surface1.glb"),p==2&&(te="model/planet2/surface2.glb"),b.load(te,function(t){Be=t.scene,e[0].mixer=new Et(t.scene),e[0].mixer.clipAction(t.animations[0]).play(),m.add(Be),f=0,Be.traverse(a=>{if(a.castShadow!==void 0&&(a.castShadow=!0,a.receiveShadow=!0,f++),p>=1){if(a.name=="main"){const u=new T().load("model/planet2/texture_grass.jpg");u.flipY=!1,u.wrapS=A,u.wrapT=A,u.repeat.set(100,100),a.material.map=u;var i=2e6;const R=new bt;var W=new Ye(.1,1.3,1,1);p==2&&(i=4e6,W=new Ye(.06,1.4,1,1)),W.translate(0,1.5,0);const Ae=new zt(W,Q,i);Ae.receiveShadow=!0;const Fe=new $,Xe=new $;let ct=new Rt(a).setWeightAttribute("random").build();for(let Te=0;Te<i;Te++)ct.sample(Fe,Xe),Xe.add(Fe),R.position.copy(Fe),R.scale.setScalar(2+Math.random()*5),R.rotation.y=Math.random()*Math.PI,R.rotation.x=Math.random()*Math.PI/5,R.rotation.z=Math.random()*Math.PI/5,R.updateMatrix(),Ae.setMatrixAt(Te,R.matrix);m.add(Ae)}if(a.name.includes("Sphere")){const u=new T().load("model/planet2/texture_leaves.png");u.flipY=!1,u.wrapS=A,u.wrapT=A,u.repeat.set(4,4),u.mapping=Ge,a.material.map=u,a.material.color.setHex(16777215),a.material.metalness=0,a.material.needsUpdate=!0}if(a.name.includes("foglie")){const u=new T().load("model/planet2/texture_leaf.png");u.flipY=!1,a.material.map=u,a.material.color.setHex(16777215),a.material.metalness=0,a.material.side=Ve,a.material.alphaTest=.5,a.material.transparent=!0,a.material.needsUpdate=!0}if(a.name.includes("Cylinder")||a.name.includes("ra")){const u=new T().load("model/planet2/texture_wood.png");u.flipY=!1,u.wrapS=A,u.wrapT=A,u.repeat.set(2,15),u.mapping=Ge,a.material.map=u,a.material.displacementMap=u,a.material.displacementScale=1,a.material.color.setHex(16777215),a.material.metalness=0,a.material.needsUpdate=!0}if(a.name.includes("Rock")){const u=new T().load("model/planet2/texture_rock.jpg");u.flipY=!1,u.wrapS=A,u.wrapT=A,u.repeat.set(25,25),a.material.map=u,a.material.normlaMap=u,a.material.displacementMap=u,a.material.displacementScale=3,a.material.color.setHex(16777215),a.material.roughness=1,a.material.metalness=0,a.material.needsUpdate=!0}}})},void 0,function(t){console.error(t)});let ae;b.load("model/ship.glb",function(t){ae=t.scene,e[0].inner=87,e[0].outer=140;const a=new z(16777215,1,75,5);a.position.set(0,10,0),ae.add(a),e[0].add(ae),e[0].position.set(-220,-5,320),e[0].rotation.y=.6,m.add(e[0]),f=0,ae.traverse(i=>{i.castShadow!==void 0&&(f!=27&&(i.castShadow=!0),i.receiveShadow=!0,f++)})},void 0,function(t){console.error(t)});var _,ie;p==2&&(_=new T().load("model/planet2/texture_desk.png"),_.flipY=!1,_.wrapS=A,_.wrapT=A,_.repeat.set(4,4),ie=new T().load("model/planet2/texture_keyboard.jpg"),ie.flipY=!1);function M(t){t.name=="Cube"&&(t.material.map=_,t.material.color.setHex(16777215),t.material.roughness=1,t.material.roughnessMap=_),t.name=="keyboard"&&(t.material.map=ie,t.material.color.setHex(16777215),t.material.roughness=1,t.material.metalness=0,t.material.normalMap=ie,t.material.needsUpdate=!0)}let oe;b.load("model/planet2/scrivania1.glb",function(t){oe=t.scene;const a=new z(16777215,1,75,5);a.position.set(0,10,0),oe.add(a),e[1].inner=20,e[1].outer=50,e[1].add(oe),m.add(e[1]),e[1].position.set(40,0,200),e[1].rotation.y=0,f=0,oe.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let ne;b.load("model/planet2/scrivania1.glb",function(t){ne=t.scene,e[2].inner=20,e[2].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),ne.add(a),e[2].add(ne),e[2].position.set(40,0,170),e[2].rotation.y=Math.PI,m.add(e[2]),f=0,ne.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let re;b.load("model/planet2/scrivania1.glb",function(t){re=t.scene,e[3].inner=20,e[3].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),re.add(a),e[3].add(re),e[3].position.set(-40,0,200),e[3].rotation.y=0,m.add(e[3]),f=0,re.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let se;b.load("model/planet2/scrivania1.glb",function(t){se=t.scene;const a=new z(16777215,1,75,5);a.position.set(0,10,0),se.add(a),e[4].inner=20,e[4].outer=50,e[4].add(se),m.add(e[4]),e[4].position.set(-40,0,170),e[4].rotation.y=Math.PI,f=0,se.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let de;b.load("model/planet2/scrivania1.glb",function(t){de=t.scene,e[5].inner=20,e[5].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),de.add(a),e[5].add(de),e[5].position.set(40,0,100),e[5].rotation.y=0,m.add(e[5]),f=0,de.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let le;b.load("model/planet2/scrivania1.glb",function(t){le=t.scene,e[6].inner=20,e[6].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),le.add(a),e[6].add(le),e[6].position.set(40,0,70),e[6].rotation.y=Math.PI,m.add(e[6]),f=0,le.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let ce;b.load("model/planet2/scrivania1.glb",function(t){ce=t.scene,e[7].inner=20,e[7].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),ce.add(a),e[7].add(ce),e[7].position.set(-40,0,100),e[7].rotation.y=0,m.add(e[7]),f=0,ce.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let fe;b.load("model/planet2/scrivania1.glb",function(t){fe=t.scene,e[8].inner=20,e[8].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),fe.add(a),e[8].add(fe),e[8].position.set(-40,0,70),e[8].rotation.y=Math.PI,m.add(e[8]),f=0,fe.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let ue;b.load("model/planet2/scrivania1.glb",function(t){ue=t.scene,e[9].inner=20,e[9].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),ue.add(a),e[9].add(ue),e[9].position.set(40,0,0),e[9].rotation.y=0,m.add(e[9]),f=0,ue.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let me;b.load("model/planet2/scrivania1.glb",function(t){me=t.scene,e[10].inner=20,e[10].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),me.add(a),e[10].add(me),e[10].position.set(40,0,-30),e[10].rotation.y=Math.PI,m.add(e[10]),f=0,me.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let pe;b.load("model/planet2/scrivania1.glb",function(t){pe=t.scene,e[11].inner=20,e[11].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),pe.add(a),e[11].add(pe),e[11].position.set(-40,0,0),e[11].rotation.y=0,m.add(e[11]),f=0,pe.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)});let ge;b.load("model/planet2/scrivania1.glb",function(t){ge=t.scene,e[12].inner=20,e[12].outer=50;const a=new z(16777215,1,75,5);a.position.set(0,10,0),ge.add(a),e[12].add(ge),e[12].position.set(-40,0,-30),e[12].rotation.y=Math.PI,m.add(e[12]),f=0,ge.traverse(i=>{i.castShadow!==void 0&&(f!=9&&(i.castShadow=!0),i.receiveShadow=!0,f++),p==2&&M(i)})},void 0,function(t){console.error(t)}),window.addEventListener("click",function(){for(var t=0;t<L;t++)g[t].near&&K&&(S.unlock(),g[t].classList.remove("reduce"),g[t].open=!0)}),document.addEventListener("keydown",s),document.addEventListener("keyup",E),B=new It({antialias:!0,preserveDrawingBuffer:!0}),B.setPixelRatio(window.devicePixelRatio),B.setSize(window.innerWidth,window.innerHeight),B.shadowMap.enabled=!0,B.shadowMap.type=Mt,document.body.appendChild(B.domElement),Ce=new Pt(m,n),U=new qe(B),U.renderToScreen=!1,U.addPass(Ce),De=new Bt(new At(window.innerWidth,window.innerHeight),1.4,.1,.1),De.threshold=.1,U.addPass(De),_e=new Ft(new Ke({uniforms:{baseTexture:{value:null},bloomTexture:{value:U.renderTarget2.texture}},vertexShader:document.getElementById("vertexshaderB").textContent,fragmentShader:document.getElementById("fragmentshaderB").textContent,defines:{}}),"baseTexture"),_e.needsSwap=!0,Z=new qe(B),Z.addPass(Ce),Z.addPass(_e);const lt=new z(16777215,1,120,3);n.add(lt),window.addEventListener("resize",Ht),Ue=new _t,J==!0&&(Qe(sessionStorage.getItem("json")),J=!1)}function Ht(){n.aspect=window.innerWidth/window.innerHeight,n.updateProjectionMatrix(),B.setSize(window.innerWidth,window.innerHeight),U.setSize(window.innerWidth,window.innerHeight),Z.setSize(window.innerWidth,window.innerHeight)}function Re(l,r,c){r<e[l].inner&&c<e[l].inner-5?(F=0,V=0,n.position.z<=e[l].position.z&&(n.position.z-=.5),n.position.z>e[l].position.z&&(n.position.z+=.5),n.position.x<=e[l].position.x&&(n.position.x-=.5),n.position.x>e[l].position.x&&(n.position.x+=.5)):(F=Me,V=1)}var Nt=1e3/60,ve=0;function at(){Date.now()>=ve&&(Vt(),p==0?B.render(m,n):(m.fog=new je(0,6e-4),m.background="",m.traverse(Xt),U.render(),v.rotation.z>1.3&&v.rotation.z<1.7&&(q.lerp(new D("#F30"),5e-4),x.color.lerp(new D("#F30"),5e-4)),v.rotation.z>1.6&&v.rotation.z<4&&q.lerp(new D("#000"),.001),v.rotation.z>4.9&&v.rotation.z<5.4&&(q.lerp(new D("#f30"),2e-4),x.color.lerp(new D("#FFF"),5e-4)),v.rotation.z>5.4&&v.rotation.z<6.6&&q.lerp(new D("#9af"),.001),m.fog=new Tt(q,200,2500),m.background=Oe,m.traverse(Kt),Z.render()),ve+=Nt,Date.now()>=ve&&(ve=Date.now())),requestAnimationFrame(at)}function Xt(l){l.isMesh&&tt.test(l.layers)===!1&&(Ee[l.uuid]=l.material,l.material=Ut)}function Kt(l){Ee[l.uuid]&&(l.material=Ee[l.uuid],delete Ee[l.uuid])}function Vt(){we++;const l=performance.now();var r=new $;if(n.getWorldDirection(r),S.isLocked===!0||ee){const P=(l-Je)/1e3;k&&(I.x=F*r.x,I.z=F*r.z),j&&(I.x=-F*r.x,I.z=-F*r.z),I.x-=I.x*10*P,I.z-=I.z*10*P,S.getObject().position.x+=I.x*P,S.getObject().position.z+=I.z*P;var c=S.getObject().position.x,h=S.getObject().position.z;c<-470&&(I.x=0,S.getObject().position.x=-470),c>280&&(I.x=0,S.getObject().position.x=280),h<-450&&(I.z=0,S.getObject().position.z=-450),h>470&&(I.z=0,S.getObject().position.z=470)}v.rotation.z+=2e-4,v.rotation.z>Math.PI*2&&(v.rotation.z-=Math.PI*2),p>0&&(N=1-Math.abs(v.rotation.z/(Math.PI*2)-.5)*2,(N<.45&&v.rotation.z<Math.PI||v.rotation.z>5.2)&&N<.88&&(H=N),N>.45&&v.rotation.z<Math.PI&&H<.88&&(H+=1e-4),v.rotation.z>4.9&&v.rotation.z<5.5&&H>N&&(H-=2e-4),Q.uniforms.light.value=H/1.2);let w=Ue.getDelta();e[0].mixer&&e[0].mixer.update(w);var d=n.position.distanceTo(e[0].position);if(d<e[0].outer?(g[0].near=!0,d<e[0].inner+5?(F=0,V=0,n.position.z<=e[o].position.z&&(n.position.z-=.5),n.position.z>e[o].position.z&&(n.position.z+=.5),n.position.x<=e[o].position.x&&(n.position.x-=.5),n.position.x>e[o].position.x&&(n.position.x+=.5)):(F=Me,V=1)):g[0].near=!1,we%3==0){for(o=1;o<L-4;o++){var d=n.position.distanceTo(e[o].position),s=Math.abs(n.position.x-e[o].position.x),E=Math.abs(n.position.z-e[o].position.z);d<e[o].outer?(g[o].near=!0,Re(o,s,E)):g[o].near=!1}for(C=!1,o=0;o<L;o++)if(g[o].near){C=!0;break}C?X.classList.add("active"):X.classList.remove("active")}if(we%3==1){for(o=L-4;o<L-9;o++){var d=n.position.distanceTo(e[o].position),s=Math.abs(n.position.x-e[o].position.x),E=Math.abs(n.position.z-e[o].position.z);d<e[o].outer?(g[o].near=!0,Re(o,s,E)):g[o].near=!1}for(C=!1,o=0;o<L;o++)if(g[o].near){C=!0;break}C?X.classList.add("active"):X.classList.remove("active")}if(we%3==2){for(o=L-9;o<L;o++){var d=n.position.distanceTo(e[o].position),s=Math.abs(n.position.x-e[o].position.x),E=Math.abs(n.position.z-e[o].position.z);d<e[o].outer?(g[o].near=!0,Re(o,s,E)):g[o].near=!1}for(C=!1,o=0;o<L;o++)if(g[o].near){C=!0;break}C?X.classList.add("active"):X.classList.remove("active")}ye&&(n.rotation.y+=.01*We),xe&&(n.rotation.y-=.01*We),Se&&(n.rotation.x+=.01*He),Le&&(n.rotation.x-=.01*He),p>=1&&(Q.uniforms.time.value=Ue.getElapsedTime(),Q.uniformsNeedUpdate=!0),Je=l}if(ee){let l=function(){blocker.classList.remove("transparent"),pause.classList.remove("reduce"),O=!1;for(var s=0;s<L;s++){if(g[s].open){O=!0;break}if(g[s].near){g[s].classList.remove("reduce"),O=!0;break}}O||menu.classList.remove("reduce"),document.getElementById("esc").style.display="none",be.classList.add("display"),K=!1};document.getElementById("mobile").style.display="block",document.getElementById("commandList").style.display="none",document.getElementById("esc").addEventListener("click",l),document.getElementById("crossair").addEventListener("touchstart",function(){for(var s=0;s<L;s++)g[s].near&&K&&(g[s].classList.remove("reduce"),g[s].open=!0,l())});let r=document.getElementById("avanti"),c=document.getElementById("indietro");r.addEventListener("touchstart",function(){k=!0}),r.addEventListener("touchend",function(){k=!1}),c.addEventListener("touchstart",function(){j=!0}),c.addEventListener("touchend",function(){j=!1});const h=document.body;let w,d;h.addEventListener("touchstart",s=>{w=s.touches[0].clientX,d=s.touches[0].clientY}),h.addEventListener("touchmove",s=>{let E,P;E=s.changedTouches[0].clientX-w,P=s.changedTouches[0].clientY-d,P<-20?Se=!0:Se=!1,P>20?Le=!0:Le=!1,E<-20?ye=!0:ye=!1,E>20?xe=!0:xe=!1,We=Math.abs(E/50),He=Math.abs(P/50)}),h.addEventListener("touchend",s=>{Se=!1,Le=!1,ye=!1,xe=!1})}document.getElementById("graph1").addEventListener("click",function(){var l=window.location.pathname;sessionStorage.setItem("graphics",0),window.location.href=l});document.getElementById("graph2").addEventListener("click",function(){var l=window.location.pathname;sessionStorage.setItem("graphics",1),window.location.href=l});document.getElementById("graph3").addEventListener("click",function(){var l=window.location.pathname;sessionStorage.setItem("graphics",2),window.location.href=l});p==0&&(document.getElementById("graph1").style.borderColor="green");p==1&&(document.getElementById("graph2").style.borderColor="green");p==2&&(document.getElementById("graph3").style.borderColor="green");document.getElementById("create-save").addEventListener("click",function(){let l=B.domElement.toDataURL("image/png",1);sessionStorage.setItem("img",l),document.getElementsByTagName("canvas")[0].toBlob(function(c){let h=new FileReader;h.readAsArrayBuffer(c),h.addEventListener("load",function(w){let d=w.target.result;const s=new Int8Array(d),E=ft(s,Ze(),"png");Yt([E],"png")})},"image/png",1),sessionStorage.setItem("save",Ze())});function Yt(l,r){var c=window.document.createElement("a");c.href=window.URL.createObjectURL(new Blob(l)),c.download="save."+r,document.body.appendChild(c),c.click(),document.body.removeChild(c)}function Ze(){var l=JSON.stringify({page:window.location.pathname,graphics:p,cameraPosition:{x:n.position.x,y:n.position.y,z:n.position.z},cameraRotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},sun:v.rotation.z,difficulty:ze,punteggio:Ie,position:2});return l}function Qe(l){var r=JSON.parse(l);sessionStorage.getItem("graphics")||(p=r.graphics);try{r.position!=0&&(n.position.x=r.cameraPosition.x,n.position.y=r.cameraPosition.y,n.position.z=r.cameraPosition.z,n.rotation.x=r.cameraRotation.x,n.rotation.y=r.cameraRotation.y,n.rotation.z=r.cameraRotation.z)}catch{}v.rotation.z=r.sun,sessionStorage.getItem("difficulty")||(ze=r.difficulty),sessionStorage.getItem("punteggio")||(Ie=r.punteggio-1)}window.onbeforeunload=function(){sessionStorage.setItem("img",!1);var l=JSON.stringify({page:"/space.html",graphics:p,sun:v.rotation.z,difficulty:ze,punteggio:Ie,position:2});sessionStorage.setItem("save",l)};
