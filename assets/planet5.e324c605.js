import{e as tt}from"./strega_bg.a0dc8f16.js";import{V as Me,M as D,P as at,G as V,c as ot,d as nt,F as ke,g as it,D as st,T as rt,L as dt,f as ee,A as lt,i as ct,C as ft,j as Se,x as mt,v as Te,H as ut,k as Re,e as Ue,r as pt,W as gt,s as yt,m as ht,E as We,U as vt,n as wt,o as xt,S as Mt,p as bt,q as Lt,t as It}from"./Lensflare.fbfcbbf5.js";let be=!1;var T=0,p=1,R=-1;sessionStorage.getItem("save")?(be=sessionStorage.getItem("save"),T=JSON.parse(sessionStorage.getItem("save")).graphics,sessionStorage.getItem("difficulty")||(p=JSON.parse(sessionStorage.getItem("save")).difficulty),sessionStorage.getItem("punteggio")||(R=JSON.parse(sessionStorage.getItem("save")).punteggio-1)):be=!1;sessionStorage.getItem("graphics")&&(T=sessionStorage.getItem("graphics"));sessionStorage.getItem("difficulty")&&(p=sessionStorage.getItem("difficulty"));sessionStorage.getItem("punteggio")&&(R=sessionStorage.getItem("punteggio")-1);p||(p=1);R||(R=-1);let a,u,I,z,Ne,K,Ee,Pe,Be,se,Ce,X=800,g=X,W=2,A=!1,O=!1,Fe=performance.now();const f=new Me;let re=!0;var St=1,Y=0,De=1,Ae=1,ge=!1,ye=!1,he=!1,ve=!1;const B=1400;var de=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(de=!0);const Et=new D({color:"black"}),we={},J=1,Ge=new bt;Ge.set(J);let Pt=document.getElementById("punteggio");a=new at(60,window.innerWidth/window.innerHeight,1,1e6);var e=[];for(var s=0;s<W;s++)e[s]=new V,e[s].outer=80,e[s].inner=50,e[s].mixer;var G=new V;let H=new V;var d=[],M=[];for(var s=0;s<W;s++)M[s]=document.getElementById("planet"+s),M[s].open=!1;var N=!1,ze=!1;const xe=document.getElementById("crossair"),Ke=document.getElementById("crossair-text"),Bt=document.getElementById("commandList");let Z=new V,_=new V,x=new V;zt();Ye();function zt(){const t=new Lt;t.onLoad=function(){document.getElementById("preloader").style.display="none"},a.position.z=0,a.position.y=100,a.position.x=0,a.rotation.x=-.2,a.rotation.y=Math.PI*.25,a.rotation.order="YXZ",e[0].rotation.order="YXZ",u=new ot,Ce=new nt(t).load(["model/skybox/1.png","model/skybox/2.png","model/skybox/3.png","model/skybox/4.png","model/skybox/5.png","model/skybox/6.png"]),u.background=Ce,u.fog=new ke(13656096,6e-4),z=new it(a,document.body);const m=document.getElementById("blocker"),S=document.getElementById("startButton"),v=document.getElementById("menu"),w=document.getElementById("pause");S.addEventListener("click",function(){de?(m.classList.add("transparent"),v.classList.add("reduce"),w.classList.add("reduce"),xe.classList.remove("display"),re=!0,document.getElementById("esc").style.display=""):z.lock();for(var n=0;n<W;n++)M[n].classList.add("reduce"),M[n].open=!1}),z.addEventListener("lock",function(){m.classList.add("transparent"),v.classList.add("reduce"),w.classList.add("reduce"),xe.classList.remove("display"),re=!0}),z.addEventListener("unlock",function(){m.classList.remove("transparent"),w.classList.remove("reduce"),N=!1;for(var n=0;n<W;n++)if(M[n].open){N=!0;break}N||v.classList.remove("reduce"),xe.classList.add("display"),re=!1}),u.add(z.getObject());const r=function(n){switch(n.code){case"KeyQ":case"KeyP":z.unlock();break;case"ArrowUp":case"KeyW":A=!0;break;case"ArrowDown":case"KeyS":O=!0;break;case"KeyE":g=X*3*St;break;case"KeyC":Bt.classList.toggle("activemanual");break}},E=function(n){switch(n.code){case"ArrowUp":case"KeyW":A=!1;break;case"ArrowDown":case"KeyS":O=!1;break;case"KeyE":g=X;break}},c=new st(16777215,1);if(c.position.set(600,2e3,800),c.target.position.set(0,0,0),!de&&T!=0){c.castShadow=!0,c.shadow.bias=-.004,c.shadow.radius=5,c.shadow.mapSize.width=8e3,c.shadow.mapSize.height=8e3,u.add(c),u.add(c.target);const n=c.shadow.camera;n.near=100,n.far=4e3,n.left=-3e3,n.right=3e3,n.top=3e3,n.bottom=-3e3;const l=new rt().load("model/planet1/lensflare2.png"),o=new dt;o.addElement(new ee(l,70,.1)),o.addElement(new ee(l,200,.2)),o.addElement(new ee(l,100,.4)),o.addElement(new ee(l,150,.4)),o.addElement(new ee(l,40,.45)),c.add(o)}const i=new lt(1052688);u.add(i);const U=new ct(1600,50,50),h=new ft;h.setHex(16755746);const P=new D({color:h,fog:!1}),q=new Se(U,P);q.position.y=2e4,q.position.x=6e3,q.position.z=8e3,q.layers.enable(J),G.add(c),G.add(q),u.add(G);const Je=new mt(1e7,1e7),Ze=new D({color:16711680,side:Te}),Q=new Se(Je,Ze);Q.rotation.x=.5*Math.PI,Q.position.y=-700,Q.castShadow=!0,Q.layers.enable(J),u.add(Q);const _e=new ut(1e6,1e6,1e6),Ve=new D({color:16711680,side:Te,opacity:0}),qe=new Se(_e,Ve);a.add(qe);const Oe=new Re(t);var b=0;let $;Oe.load("model/ship.glb",function(n){$=n.scene,e[0].inner=87,e[0].outer=140,$.scale.setScalar(.35,.35,.35);const k=new Ue(16777215,1,450,2);k.position.set(0,-30,0),$.add(k),e[0].add($),e[0].position.set(0,-30,-90),e[0].rotation.y=Math.PI/2,e[0].rotation.z=Math.PI/8,a.add(e[0]),b=0;let l=new D({color:15745024,fog:!1});$.traverse(o=>{o.castShadow!==void 0&&(b!=27&&(o.castShadow=!0),o.receiveShadow=!0,b==24&&(_=o),b==23&&(Z=o),b==17&&(x=o),b<23&&b>17&&(o.material=l,o.material.needUpdate=!0,o.layers.enable(J)),b++)})},void 0,function(n){console.error(n)}),u.add(H);let Qe=new D({color:13684944}),$e=new D({color:14483626}),je=new D({color:56746}),et=new D({color:14526976});var b=0;let Le;var Ie;T==0?Ie="model/planet5/platform_1.glb":Ie="model/planet5/platform_2.glb",Oe.load(Ie,function(n){Le=n.scene,Le.position.y=-230,Le.scale.set(2,2,2);for(var k=-1,l=0;l<64;l++)l%8==0&&k++,d[l]=n.scene.clone(),d[l].position.z=B*(l%8-4),d[l].position.x=B*(k-4),d[l].rotation.y=Math.random()*6-3,d[l].traverse(o=>{o.castShadow!==void 0&&(o.castShadow=!0,o.receiveShadow=!0),o.isMesh&&(o.name.includes("cube")&&(ie(o),o.material.roughness=.8,o.material.needUpdate=!0),o.name.includes("Sphere")&&(o.material=Qe,o.material.needUpdate=!0,o.layers.enable(J)),o.name.includes("crystal")&&(o.layers.enable(J),Math.random()>.33?o.material=$e:Math.random()>.66?o.material=je:o.material=et,o.material.needUpdate=!0))}),H.add(d[l])},void 0,function(n){console.error(n)});let j;new Re(t).load("model/planet5/token.glb",function(n){j=n.scene,j.scale.set(1.3,1.3,1.3),e[1].mixer=new pt(n.scene),e[1].mixer.clipAction(n.animations[0]).play();const k=new Ue(16777215,1,150,5);k.position.set(11,40,0),j.add(k),e[1].inner=70,e[1].outer=90,e[1].add(j),H.add(e[1]),e[1].position.set(-300,70,-300),e[1].rotation.y=Math.PI*-.25,b=0,j.traverse(l=>{l.castShadow!==void 0&&(l.castShadow=!0,b++)})},void 0,function(n){console.error(n)}),document.addEventListener("keydown",r),document.addEventListener("keyup",E),I=new gt({antialias:!0,preserveDrawingBuffer:!0}),I.setPixelRatio(window.devicePixelRatio),I.setSize(window.innerWidth,window.innerHeight),I.shadowMap.enabled=!0,I.shadowMap.type=yt,document.body.appendChild(I.domElement),Ee=new ht(u,a),K=new We(I),K.renderToScreen=!1,K.addPass(Ee),Pe=new vt(new wt(window.innerWidth,window.innerHeight),1.8,.1,.1),Pe.threshold=.1,K.addPass(Pe),Be=new xt(new Mt({uniforms:{baseTexture:{value:null},bloomTexture:{value:K.renderTarget2.texture}},vertexShader:document.getElementById("vertexshaderB").textContent,fragmentShader:document.getElementById("fragmentshaderB").textContent,defines:{}}),"baseTexture"),Be.needsSwap=!0,se=new We(I),se.addPass(Ee),se.addPass(Be),window.addEventListener("resize",kt),Ne=new It,be==!0&&(Rt(sessionStorage.getItem("json")),be=!1)}function kt(){a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight),K.setSize(window.innerWidth,window.innerHeight),se.setSize(window.innerWidth,window.innerHeight)}function ie(t){t.position.y=Math.random()*-50,t.position.x+=Math.random()*50-25,t.position.z+=Math.random()*50-25,t.rotation.y=Math.random()*Math.PI*2,t.rotation.x=Math.random()*Math.PI*.04-.02,t.rotation.y=Math.random()*Math.PI*.04-.02}var Ct=1e3/60,me=0;function Ye(){Date.now()>=me&&(Ot(),T==0?I.render(u,a):(u.fog=new ke(0,6e-4),u.background="",u.traverse(Dt),K.render(),u.fog=new ke(12603424,6e-4),u.background=Ce,u.traverse(At),se.render()),me+=Ct,Date.now()>=me&&(me=Date.now())),requestAnimationFrame(Ye)}function Dt(t){t.isMesh&&Ge.test(t.layers)===!1&&(we[t.uuid]=t.material,t.material=Et)}function At(t){we[t.uuid]&&(t.material=we[t.uuid],delete we[t.uuid])}var F=new Me,Xe=0;function Ot(){Y++;const t=performance.now();if(Z.rotation.y-=.03,_.rotation.y+=.03,A?g>X?(Z.rotation.y-=.4,_.rotation.y+=.4,x.position.x>-7&&(x.position.x-=2)):(x.position.x>-7&&x.position.x>16?x.position.x-=1:x.position.x+=1,Z.rotation.y-=.2,_.rotation.y+=.2):x.position.x<53&&(x.position.x+=5),O&&(g>X?(Z.rotation.y+=.4,_.rotation.y-=.4):(Z.rotation.y+=.2,_.rotation.y-=.2)),x.position.x-=Math.sin(Y),x.position.y+=Math.sin(Y*2)/2,x.position.z+=Math.cos(Y*3)/2,!A&&!O&&(e[0].position.y+=Math.sin(Y/30)/30),a.getWorldDirection(F),z.isLocked===!0||de){const h=(t-Fe)/1e3;A&&(f.y=g*F.y,f.x=g*F.x,f.z=g*F.z),O&&(f.y=-g*F.y,f.x=-g*F.x,f.z=-g*F.z),f.y-=f.y*10*h,f.x-=f.x*10*h,f.z-=f.z*10*h,z.getObject().position.y+=f.y*h,H.position.x-=f.x*h,oe-=f.x*h,H.position.z-=f.z*h,ne-=f.z*h;var y=z.getObject().position.y;if(y<50&&(f.y=0,z.getObject().position.y=50),y>1500){f.y=0;var m=window.location.origin;m=m+"/space.html",window.location.href=m}}G.rotation.z+=2e-4;let S=Ne.getDelta();for(s=1;s<W;s++)if(e[s].mixer&&e[s].mixer.update(S),Y%2==0){var v=new Me;e[0].getWorldPosition(v);var w=new Me;e[s].getWorldPosition(w);var r=Math.abs(Math.abs(v.x)-Math.abs(w.x)),E=Math.abs(Math.abs(v.y)-Math.abs(w.y)),c=Math.abs(Math.abs(v.z)-Math.abs(w.z));r<e[s].inner&&E<e[s].inner&&c<e[s].inner&&(H.remove(e[1]),R+=1,Pt.innerHTML=R,p==1&&(e[1].position.x-=Math.random()*1e3+300,e[1].position.z-=Math.random()*1e3+300,e[1].position.y=Math.random()*500+100),p==2&&(e[1].position.x-=Math.random()*1200+100,e[1].position.z-=Math.random()*1200+100,e[1].position.y=Math.random()*800+100),p==3&&(e[1].position.x-=Math.random()*2e3-1e3,e[1].position.z-=Math.random()*2e3-1e3,e[1].position.y=Math.random()*900+100),H.add(e[1]))}for(ze=!1,s=1;s<W;s++)if(M[s].near){ze=!0;break}if(ze?Ke.classList.add("active"):Ke.classList.remove("active"),ge&&(a.rotation.y+=.01*De),ye&&(a.rotation.y-=.01*De),he&&(a.rotation.x+=.01*Ae),ve&&(a.rotation.x-=.01*Ae),oe<-B){ue||(L++,ue=!0,te=!1);for(var i=Math.abs(L)%8*8;i<Math.abs(L)%8*8+8;i++)d[i].position.x=d[i].position.x+B*8,d[i].rotation.y=Math.random()*(Math.PI*2),d[i].traverse(h=>{h.isMesh&&ie(h)});L++,te=!1,oe=0}if(oe>B){ue&&(te?L=7:L--,ue=!1,te=!1);for(var i=Math.abs(L)%8*8;i<Math.abs(L)%8*8+8;i++)d[i].position.x=d[i].position.x-B*8,d[i].rotation.y=Math.random()*(Math.PI*2),d[i].traverse(P=>{P.isMesh&&ie(P)});L--,te=!1,L==-1&&(L=7),oe=0}if(ne<-B){pe||(C++,pe=!0,ae=!1);for(var i=Math.abs(C)%8;i<64;i=i+8)d[i].position.z=d[i].position.z+B*8,d[i].rotation.y=Math.random()*(Math.PI*2),d[i].traverse(P=>{P.isMesh&&ie(P)});C++,ae=!1,ne=0}if(ne>B){pe&&(ae?C=7:C--,pe=!1,ae=!1);for(var i=Math.abs(C)%8;i<64;i=i+8)d[i].position.z=d[i].position.z-B*8,d[i].rotation.y=Math.random()*(Math.PI*2),d[i].traverse(P=>{P.isMesh&&ie(P)});C--,ae=!1,C==-1&&(C=7),ne=0}var U=(a.rotation.y+Math.PI-Xe)*-15;e[0].rotation.x<U&&(Math.abs(U-e[0].rotation.x)>1?e[0].rotation.x+=.1:Math.abs(U-e[0].rotation.x)>.5?e[0].rotation.x+=.03:e[0].rotation.x+=.01),e[0].rotation.x>U&&(Math.abs(U-e[0].rotation.x)>1?e[0].rotation.x-=.1:Math.abs(U-e[0].rotation.x)>.5?e[0].rotation.x-=.03:e[0].rotation.x-=.01),A&&(g>X?a.fov<65&&(a.fov+=.2,a.updateProjectionMatrix()):a.fov<62&&(a.fov+=.2,a.updateProjectionMatrix())),O&&(g>X?a.fov>55&&(a.fov-=.2,a.updateProjectionMatrix()):a.fov>58&&(a.fov-=.2,a.updateProjectionMatrix())),!A&&!O&&(a.fov<60&&(a.fov+=.2,a.updateProjectionMatrix()),a.fov>60&&(a.fov-=.2,a.updateProjectionMatrix())),Xe=a.rotation.y+Math.PI,Fe=t}var te=!0,ae=!0,ue=!0,pe=!0,C=0,L=0,oe=0,ne=0;if(de){let t=function(){blocker.classList.remove("transparent"),pause.classList.remove("reduce"),N=!1;for(var r=0;r<W;r++){if(M[r].open){N=!0;break}if(M[r].near){M[r].classList.remove("reduce"),N=!0;break}}N||menu.classList.remove("reduce"),document.getElementById("esc").style.display="none",xe.classList.add("display"),re=!1};document.getElementById("mobile").style.display="block",document.getElementById("commandList").style.display="none",document.getElementById("esc").addEventListener("click",t),document.getElementById("crossair").addEventListener("touchstart",function(){for(var r=0;r<W;r++)M[r].near&&re&&(M[r].classList.remove("reduce"),M[r].open=!0,t())});let y=document.getElementById("avanti"),m=document.getElementById("indietro");y.addEventListener("touchstart",function(){A=!0}),y.addEventListener("touchend",function(){A=!1}),m.addEventListener("touchstart",function(){O=!0}),m.addEventListener("touchend",function(){O=!1});const S=document.body;let v,w;S.addEventListener("touchstart",r=>{v=r.touches[0].clientX,w=r.touches[0].clientY}),S.addEventListener("touchmove",r=>{let E,c;E=r.changedTouches[0].clientX-v,c=r.changedTouches[0].clientY-w,c<-20?he=!0:he=!1,c>20?ve=!0:ve=!1,E<-20?ge=!0:ge=!1,E>20?ye=!0:ye=!1,De=Math.abs(E/50),Ae=Math.abs(c/50)}),S.addEventListener("touchend",r=>{he=!1,ve=!1,ge=!1,ye=!1})}let le=document.getElementById("diff1"),ce=document.getElementById("diff2"),fe=document.getElementById("diff3");le.addEventListener("click",function(){g=800,p=1,sessionStorage.setItem("difficulty",1),le.style.borderColor="green",ce.style.borderColor="rgb(68 104 255)",fe.style.borderColor="rgb(68 104 255)"});ce.addEventListener("click",function(){g=1e3,p=2,sessionStorage.setItem("difficulty",2),le.style.borderColor="rgb(68 104 255)",ce.style.borderColor="green",fe.style.borderColor="rgb(68 104 255)"});fe.addEventListener("click",function(){g=1500,p=3,sessionStorage.setItem("difficulty",3),le.style.borderColor="rgb(68 104 255)",ce.style.borderColor="rgb(68 104 255)",fe.style.borderColor="green"});p==1&&le.click();p==2&&ce.click();p==3&&fe.click();document.getElementById("graph1").addEventListener("click",function(){var t=window.location.pathname;sessionStorage.setItem("graphics",0),window.location.href=t});document.getElementById("graph2").addEventListener("click",function(){var t=window.location.pathname;sessionStorage.setItem("graphics",1),window.location.href=t});T==0?document.getElementById("graph1").style.borderColor="green":document.getElementById("graph2").style.borderColor="green";document.getElementById("create-save").addEventListener("click",function(){let t=I.domElement.toDataURL("image/png",1);sessionStorage.setItem("img",t),document.getElementsByTagName("canvas")[0].toBlob(function(m){let S=new FileReader;S.readAsArrayBuffer(m),S.addEventListener("load",function(v){let w=v.target.result;const r=new Int8Array(w),E=tt(r,He(),"png");Tt([E],"png")})},"image/png",1),sessionStorage.setItem("save",He())});function Tt(t,y){var m=window.document.createElement("a");m.href=window.URL.createObjectURL(new Blob(t)),m.download="save."+y,document.body.appendChild(m),m.click(),document.body.removeChild(m)}function He(){var t=JSON.stringify({page:window.location.pathname,graphics:T,sun:G.rotation.z,difficulty:p,punteggio:R,position:5});return t}function Rt(t){var y=JSON.parse(t);sessionStorage.getItem("graphics")||(T=y.graphics),G.rotation.z=y.sun,sessionStorage.getItem("difficulty")||(p=y.difficulty),sessionStorage.getItem("punteggio")||(R=y.punteggio-1)}window.onbeforeunload=function(){sessionStorage.setItem("img",!1);var t=JSON.stringify({page:"/space.html",graphics:T,sun:G.rotation.z,difficulty:p,punteggio:R,position:5});sessionStorage.setItem("save",t)};
